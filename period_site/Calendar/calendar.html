<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cycle Tracker</title>
  <style>
    body {
      font-family: system-ui, Arial;
      max-width: 640px;
      margin: 40px auto;
      padding: 0 16px;
    }

    h1 {
      margin: 0 0 10px;
    }

    input,
    button {
      padding: 8px 10px;
      margin: 6px 0;
    }

    button {
      font-weight: 700;
      cursor: pointer;
    }

    .row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .card {
      background: #f6f6f6;
      border-radius: 8px;
      padding: 12px;
      margin-top: 14px;
    }

    pre {
      background: #0f172a;
      color: #e2e8f0;
      padding: 12px;
      border-radius: 8px;
      overflow: auto;
    }
  </style>
</head>

<body>
  <h1>Cycle Tracker</h1>

  <div class="row">
    <label for="periodDate">Last period date:</label>
    <input type="date" id="periodDate" />
    <button id="checkBtn">Check</button>
  </div>

  <div class="card">
    <div id="human"></div>
  </div>

  <h3>Raw JSON</h3>
  <pre id="json">{}</pre>

  <script>
    // ====== CONFIG ======
    // If your HTML is served by the Java server (same-origin), use RELATIVE fetch:
    const USE_RELATIVE = true;

    async function check() {
      const date = document.getElementById('periodDate').value || new Date().toISOString().slice(0, 10);
      const url = USE_RELATIVE
        ? `/cycle?last=${encodeURIComponent(date)}`
        : `http://localhost:8000/cycle?last=${encodeURIComponent(date)}`; // use actual backend port if different

      const jsonPre = document.getElementById('json');
      const human = document.getElementById('human');
      jsonPre.textContent = 'Loading...';

      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        // Pretty JSON
        jsonPre.textContent = JSON.stringify(data, null, 2);

        // Human summary
        human.innerHTML = `
          <div><strong>Start:</strong> ${data.last}</div>
          <div><strong>Day:</strong> ${data.day}</div>
          <div><strong>Phase:</strong> ${data.phase}</div>
          <div><strong>Next period:</strong> ${data.nextPeriod}</div>
          ${data.symptoms ? `<div style="margin-top:8px">${data.symptoms}</div>` : ""}
        `;
      } catch (e) {
        jsonPre.textContent = `Error connecting to backend: ${e}`;
        human.textContent = '';
      }
    }

    document.getElementById('checkBtn').addEventListener('click', check);
  </script>
</body>

</html>